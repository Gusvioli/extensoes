<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Servidores PÃºblicos - P2P Secure Chat</title>
    <link rel="stylesheet" href="css/styles.css" />
    <style>
      .public-server-card {
        border-left: 5px solid var(--accent-color);
      }
      .public-server-card.active {
        border-left-color: var(--success-color);
      }
      .public-server-card.inactive {
        border-left-color: var(--danger-color);
      }
      .public-server-card.standby {
        border-left-color: var(--warning-color);
      }

      .copy-token-btn {
        background: var(--light-bg);
        border: 1px solid #ddd;
        width: 100%;
        padding: 8px;
        margin-top: 10px;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.2s;
      }
      .copy-token-btn:hover {
        background: #e0e0e0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸŒ Servidores PÃºblicos</h1>
        <div class="header-actions">
          <a href="/" class="btn-secondary">ğŸ” Ãrea Administrativa</a>
        </div>
      </header>

      <div class="card mb-2">
        <p>
          Abaixo estÃ£o listados os servidores de sinalizaÃ§Ã£o disponÃ­veis para
          uso com a extensÃ£o P2P Secure Chat.
        </p>
      </div>

      <div id="servers-container" class="servers-grid">
        <div style="text-align: center; padding: 20px">
          Carregando servidores...
        </div>
      </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script>
      document.addEventListener("DOMContentLoaded", loadPublicServers);

      async function loadPublicServers() {
        try {
          const res = await fetch("/api/public-servers");
          const data = await res.json();
          renderServers(data.servers || []);
        } catch (e) {
          document.getElementById("servers-container").innerHTML =
            '<div style="text-align:center; color:red;">Erro ao carregar servidores.</div>';
        }
      }

      function renderServers(servers) {
        const container = document.getElementById("servers-container");
        if (servers.length === 0) {
          container.innerHTML =
            '<div style="text-align:center;">Nenhum servidor pÃºblico disponÃ­vel no momento.</div>';
          return;
        }

        container.innerHTML = servers
          .map(
            (server) => `
                <div class="card public-server-card ${server.status}">
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <h3>${server.name}</h3>
                        <span class="status-badge ${server.status}">
                            ${server.status === "active" ? "ğŸŸ¢ Online" : "ğŸ”´ Offline"}
                        </span>
                    </div>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">${server.description || "Sem descriÃ§Ã£o"}</p>
                    
                    <div class="info-row">
                        <span class="info-label">URL:</span>
                        <span class="info-value">${server.protocol}://${server.host}:${server.port}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">RegiÃ£o:</span>
                        <span class="info-value">${server.region || "N/A"}</span>
                    </div>
                    
                    ${
                      server.requiresAuth
                        ? `
                        <div style="margin-top: 15px;">
                            <div style="font-size: 0.8em; font-weight: bold; margin-bottom: 5px;">Token de AutenticaÃ§Ã£o:</div>
                            <code style="display:block; background:#f5f5f5; padding:8px; border-radius:4px; word-break:break-all; font-size:0.85em;">${server.token}</code>
                            <button class="copy-token-btn" onclick="copyToken('${server.token}')">ğŸ“‹ Copiar Token</button>
                        </div>
                    `
                        : '<div style="margin-top:15px; color:green;">ğŸ”“ Acesso Livre (Sem token)</div>'
                    }
                </div>
            `,
          )
          .join("");
      }

      function copyToken(token) {
        navigator.clipboard.writeText(token).then(() => {
          const toast = document.createElement("div");
          toast.className = "toast success";
          toast.textContent = "Token copiado!";
          document.getElementById("toast-container").appendChild(toast);
          setTimeout(() => toast.remove(), 3000);
        });
      }
    </script>
  </body>
</html>
