<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>P2P Chat</title>
  </head>
  <body>
    <div class="container">
      <!-- VIEW 1: LOGIN (Integrado ao Dashboard) -->
      <div id="view-login" class="view-section active">
        <div class="login-header">
          <h2>P2P Secure Chat</h2>
          <p class="login-subtitle">Fa√ßa login com sua conta do Dashboard</p>
        </div>

        <input type="text" id="login-username" placeholder="Usu√°rio" />
        <input type="password" id="login-password" placeholder="Senha" />
        <button id="btn-login">Entrar</button>
        <div id="login-error" class="error-msg"></div>
      </div>

      <!-- VIEW 2: LISTA DE SERVIDORES -->
      <div id="view-servers" class="view-section">
        <div class="header-row">
          <div class="header-actions">
            <button id="btn-open-settings" class="btn-secondary btn-sm">
              ‚öôÔ∏è
            </button>
            <button id="btn-logout" class="btn-danger btn-xs">Sair</button>
          </div>
          <h3>Servidores Dispon√≠veis</h3>
        </div>
        <div id="user-welcome" class="user-welcome"></div>

        <div id="servers-list-container" class="servers-list-container">
          <!-- Servidores injetados via JS -->
          <div class="loading-placeholder">Carregando servidores...</div>
        </div>

        <button id="btn-refresh-servers" class="btn-secondary mt-10">
          Atualizar Lista
        </button>
      </div>

      <!-- VIEW 3: CHAT -->
      <div id="view-chat" class="view-section">
        <!-- Chat Header Group -->
        <div class="chat-header">
          <div class="status-bar">
            <span
              >Status:
              <span
                id="connection-status"
                class="status-indicator status-offline"
                >Desconectado</span
              ></span
            >
            <div class="status-actions">
              <button id="btn-reconnect" class="btn-reconnect-sm">
                Reconectar
              </button>
              <button
                id="btn-disconnect"
                class="btn-secondary btn-disconnect-sm"
              >
                Desconectar
              </button>
            </div>
          </div>
          <div class="my-id-box" id="my-id-display" title="Clique para copiar">
            ID: Carregando...
          </div>
          <!-- Crypto Box moved here -->
          <div class="crypto-box crypto-header-box">
            <span id="crypto-status" class="crypto-status-text"
              >Chaves n√£o geradas</span
            >
            <div class="crypto-actions">
              <button id="btn-gen-keys" class="btn-crypto-sm">Gerar</button
              ><button id="btn-exchange-keys" class="btn-crypto-sm" disabled>
                Trocar
              </button>
            </div>
          </div>
          <input
            type="text"
            id="target-id"
            placeholder="ID do Destinat√°rio"
            class="input-target-id"
          />
        </div>

        <div class="messages-box" id="messages-list">
          <!-- Mensagens aparecer√£o aqui -->
        </div>

        <!-- Chat Footer Group -->
        <div class="chat-footer">
          <div id="typing-indicator" class="typing-indicator-footer"></div>

          <!-- Preview Bars (Reply/Edit) -->
          <div id="reply-preview-bar" class="reply-preview-bar-footer">
            <div class="reply-sender" id="reply-preview-sender">Sender</div>
            <div class="reply-text" id="reply-preview-text">Text</div>
            <button id="btn-cancel-reply" class="btn-close-preview">√ó</button>
          </div>

          <div id="edit-preview-bar" class="edit-preview-bar-footer">
            <div class="edit-label">Editando mensagem...</div>
            <button id="btn-cancel-edit" class="btn-close-preview">√ó</button>
          </div>

          <div class="chat-input-area">
            <div id="emoji-picker" class="emoji-picker"></div>
            <button id="btn-emoji" class="btn-secondary btn-emoji">üòä</button>
            <textarea
              id="message-input"
              rows="2"
              placeholder="Digite sua mensagem..."
              class="message-input"
            ></textarea>
            <button id="btn-send" class="btn-send">
              <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- VIEW 4: CONFIGURA√á√ïES -->
      <div id="view-settings" class="view-section">
        <h3>‚öôÔ∏è Configura√ß√µes</h3>

        <label for="setting-theme" class="settings-label">Tema</label>
        <div id="theme-selector" class="theme-selector">
          <button type="button" class="theme-btn" data-value="light">
            <span class="theme-icon">‚òÄÔ∏è</span>
            <span>Claro</span>
          </button>
          <button type="button" class="theme-btn" data-value="dark">
            <span class="theme-icon">üåô</span>
            <span>Escuro</span>
          </button>
        </div>

        <hr class="settings-hr" />

        <label for="setting-my-nickname" class="settings-label-sm"
          >Meu Apelido P√∫blico</label
        >
        <input
          type="text"
          id="setting-my-nickname"
          placeholder="Como os outros ver√£o voc√™ (ex: Alice)"
          maxlength="20"
        />
        <p class="settings-desc">
          Este nome ser√° enviado criptografado apenas para quem voc√™ conectar. O
          servidor n√£o ter√° acesso.
        </p>

        <hr class="settings-hr" />

        <div class="checkbox-row">
          <input
            type="checkbox"
            id="setting-use-fixed-id"
            class="checkbox-input"
          />
          <label for="setting-use-fixed-id" class="checkbox-label"
            >Usar Username como ID Fixo</label
          >
        </div>
        <p class="settings-desc-bottom" style="color: var(--danger); margin-bottom: 15px;">
          ‚ö†Ô∏è <strong>Aten√ß√£o:</strong> Isso torna seu ID previs√≠vel. Qualquer pessoa que saiba seu usu√°rio poder√° tentar conectar-se com ele.
        </p>

        <div class="checkbox-row">
          <input
            type="checkbox"
            id="setting-clear-exit"
            class="checkbox-input"
          />
          <label for="setting-clear-exit" class="checkbox-label"
            >Limpar hist√≥rico ao fechar</label
          >
        </div>
        <p class="settings-desc-bottom">
          Se ativado, o hist√≥rico de conversas ser√° apagado sempre que a
          extens√£o for aberta.
        </p>

        <div class="checkbox-row mb-10">
          <input
            type="checkbox"
            id="setting-notifications"
            class="checkbox-input"
            checked
          />
          <label for="setting-notifications" class="checkbox-label"
            >Receber notifica√ß√µes de novas mensagens</label
          >
        </div>

        <div class="checkbox-row mb-10">
          <input
            type="checkbox"
            id="setting-sounds"
            class="checkbox-input"
            checked
          />
          <label for="setting-sounds" class="checkbox-label"
            >Reproduzir sons</label
          >
        </div>

        <div class="checkbox-row mb-10">
          <input
            type="checkbox"
            id="setting-auto-reconnect"
            class="checkbox-input"
            checked
          />
          <label for="setting-auto-reconnect" class="checkbox-label"
            >Reconectar automaticamente</label
          >
        </div>

        <button id="btn-clear-history" class="btn-danger">
          üóëÔ∏è Limpar Hist√≥rico de Chats
        </button>

        <hr class="settings-hr" />

        <button id="btn-save-settings">Salvar</button>
        <button id="btn-cancel-settings" class="btn-secondary">Cancelar</button>
      </div>
    </div>

    <!-- Scripts: Ordem importa -->
    <script src="crypto-handler.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
