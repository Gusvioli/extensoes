version: "3.8"

services:
  p2p-signaling-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: p2p-secure-chat-server
    ports:
      - "8080:8080"
    environment:
      # üîê AUTENTICA√á√ÉO
      PORT: 8080
      REQUIRE_AUTH: "true"
      AUTH_TOKEN: ${AUTH_TOKEN:-seu-token-aqui-32-caracteres-minimo}

      # üë• LIMITES
      MAX_CLIENTS: 10000

      # ‚è±Ô∏è RATE LIMITING
      RATE_LIMIT_WINDOW: 1000
      RATE_LIMIT_MAX: 100

      # üõ°Ô∏è SEGURAN√áA
      DISABLE_DEFLATE: "true"

      # üíì HEARTBEAT
      HEARTBEAT_INTERVAL: 30000
      HEARTBEAT_TIMEOUT: 5000

      # üìä MONITORAMENTO (desabilitado por padr√£o)
      ENABLE_METRICS: "false"

    restart: unless-stopped

    # Logs
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    # Network
    networks:
      - p2p-network

networks:
  p2p-network:
    driver: bridge

# Para usar este arquivo:
#
# 1. Copie este arquivo para docker-compose.yml
# 2. Gere um token seguro:
#    export AUTH_TOKEN=$(openssl rand -hex 32)
# 3. Inicie os servi√ßos:
#    docker-compose up -d
# 4. Verifique os logs:
#    docker-compose logs -f
# 5. Pare os servi√ßos:
#    docker-compose down
#
# Vari√°veis de Ambiente:
#   AUTH_TOKEN - Obrigat√≥rio para produ√ß√£o
#   PORT - Porta do servidor (padr√£o: 8080)
